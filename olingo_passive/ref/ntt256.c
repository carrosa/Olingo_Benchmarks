#include <gmp.h>
#include "params.h"
#include "ntt256.h"
#include "reduce256.h"

// static const char *const zetas_str[N] = {
// 	"0", "-25847", "-518909", "-2608894", "876248", "466468", "237124", "777960",
// 	"2884855", "-3119733", "3111497", "-2680103", "-1826347", "2353451", "2091905", "359251",
// 	"-3277672", "-1399561", "3859737", "2118186", "1757237", "19422", "280005", "4010497",
// 	"1024112", "2725464", "1079900", "3585928", "2108549", "-2619752", "-1119584", "-549488",
// 	"1600420", "3699596", "3507263", "2140649", "-3821735", "3505694", "1643818", "1699267",
// 	"-811944", "531354", "-3881043", "-954230", "2071892", "2797779", "-3900724", "-2556880",
// 	"3077325", "-3530437", "-2706023", "95776", "3592148", "1661693", "-2537516", "-3915439",
// 	"539299", "-2348700", "-300467", "3539968", "-3574422", "-2867647", "-3861115", "3043716",
// 	"210977", "-2389356", "759969", "1316856", "3724342", "-8578", "3249728", "-1653064",
// 	"-904516", "3958618", "44288", "1100098", "3097992", "508951", "-264944", "3343383",
// 	"-3553272", "189548", "-3159746", "-1851402", "-1341330", "-1315589", "-177440", "-2409325",
// 	"-3019102", "3881060", "3839961", "-3628969", "1584928", "-1285669", "-812732", "1439742",
// 	"1452451", "3475950", "1585221", "-2176455", "-1528703", "-3930395", "3677745", "-3041255",
// 	"-1000202", "-4083598", "-1939314", "1257611", "-3190144", "3157330", "126922", "-3632928",
// 	"1430430", "-1852771", "1349076", "-381987", "22981", "-1308169", "-671102", "1228525",
// 	"3693493", "2967645", "-411027", "2477047", "-3412210", "-983419", "-2715295", "-2147896",
// 	"3014001", "1616392", "-162844", "3183426", "810149", "-1652634", "-1799107", "-3694233",
// 	"2432395", "-2013608", "-2454455", "-164721", "1207385", "-185531", "3369112", "1957272",
// 	"3724270", "2584293", "594136", "3776993", "542412", "-2831860", "1846953", "1671176",
// 	"-2235880", "3406031", "1500165", "-777191", "-1374803", "-2546312", "-1917081", "1279661",
// 	"3866901", "-269760", "3038916", "3523897", "975884", "-2213111", "1717735", "-472078",
// 	"3833893", "260646", "-1104333", "-1667432", "1803090", "1910376", "-426683", "-1723600",
// 	"554416", "3919660", "1362209", "48306", "-846154", "-1976782", "-3937738", "1400424",
// 	"-2286327", "-420899", "2235985", "2939036", "183443", "976891", "-3545687", "1612842",
// 	"2434439", "266997", "1235728", "3513181", "3193378", "1197226", "-3759364", "-3520352",
// 	"2316500", "-3817976", "-2091667", "3407706", "-2244091", "3342478", "-2446433", "3562462",
// 	"43260", "-522500", "495491", "1613174", "819034", "909542", "-1859098", "-900702",
// 	"655327", "-3122442", "-3207046", "-2031748", "-768622", "3595838", "3556995", "-525098",
// 	"1962642", "-3306115", "1312455", "-451100", "3318210", "-1430225", "-1333058", "-1237275",
// 	"-1869119", "2994039", "1903435", "1050970", "3767016", "1250494", "3548272", "-2635921",
// 	"1265009", "-2590150", "-2691481", "-2842341", "4055324", "-1247620", "1595974", "2486353",
// 	"286988", "342297", "2437823", "4108315", "-203044", "-1735879", "-3342277", "3437287"
// };

// static const char *const zetas_str[N] = {
// 	"0", "-714503319658972893228534625466015297830826746897320953", "53607788611935687685818571179721009222093604051906535", "369017823941118728309852343822504458093590495288791417", "78040444553058076415396884783890695266667531908326086", "137203398787906138760578818013228190573408650642528124", "443978064615419493388138049456336977780137956346817411", "-601784613114612081806920063970949837533523794082909827",
// 	"565940993160813713254746453710694170077486864207808230", "-552452585641963950120482991856432399799226841304094867", "325352426899708083233898039687955065816750973709935990", "493778125450975122674953884358665414218777366111915180", "506816929605968527059673920428338280924752350400179774", "680345619957003858863045095160292726983885268161889882", "82226053952055800756944817987980736219782933061228906", "432064538128875210574771265874030228855583609830958342",
// 	"-446322192316983577577083734996538801260204247725488112", "318957013507257351477369304925060413610631542689898290", "442725646498233191547678140230114268175101606804539855", "503873849336363424543952356740972450534528196186942176", "-315177662483744596999307702759881605398623364917300484", "-74886633156119373553677406971158723077062795024814558", "-448486231504898757500119292779544025245012433125898785", "-221170670621344226578968755373771123706090176137943878",
// 	"-464756837517093243921023346436650308890224725041855500", "-663546410259669772173983509644446284373748388054798941", "363349569163499938426030027959877832124135011384725169", "-438355440240193642674627197373510225241168534868242311", "-284551803119876661700009645654743737618240162260053221", "633605640809370329906648119859550379591933735005893338", "300777283351201910231673026556165197860797675966121794", "95820696648423621588669834252184053544106933008756092",
// 	"-671841614745693075993681521688260711963282542660868123", "15475483683309438156987972262624102174046440347119066", "141635142263281456949023987711244143350993266295543385", "274779328132760360726553397363296542872046482661347055", "596175054598290967792677715149017862694265259440234244", "-418668774756790874243226450948488383152224206701355940", "12128632176470381622888946587942873750786459440300326", "-16631055873637548293420336515211308606237405168300726",
// 	"634205504352691854472745435646994304302330617822813915", "634679137763717608050421505894055226296675962409120386", "-618204397013394852484127990982588825154042824485907707", "-625087255235732501460008846799305430611592362242575405", "-316055688732600284318442919018572908165735552326280008", "352895938716283833450134026912830652041161859653541620", "389589138686356617589551010903676086046404880155109782", "-91460550892235843685856152950983985229330672739040765",
// 	"-517491517838289011659552831578598819251604204282121201", "-178246592330908654710135571095563956546118501620267534", "-639478505158010311688882017316794719976561228911961079", "-135557677646618842842911747844794314770307461176249688", "-363480332530342953210140957330953358926778201617292627", "-165703947296944892576941371324340683258791510060071885", "-91335595502093702856482802525930743941781708297945772", "-632323587595733401962428671993651861615602254040254609",
// 	"-37186511493389827513418700975329566043981978225281144", "-224844987725228517597671572696504497903922361579388090", "532518729096007912750187766981654990437571916661385091", "-536456342204453092116945884183856498365846983934491664", "627786689503878325226978498668543061143794163699970821", "238729981906098111649635404917910195048410353322318324", "330847645750232888904585088098551211461252600306342423", "513125771719160752710881559285559178017795022252802364",
// 	"-594189567640966518009172822917967668613057085235319342", "-535721966452298808208859934626457579876127027394443566", "-197081565699435427952734480245377289170041049146131104", "153341409719126813471202750309369666180915091955867436", "-620325403523370070119894307274905985343610988792979951", "102765447259608971816173930308824435081814531965060788", "-220121486414208571758285151104872313010056891512034405", "619497970042863537553321554311745355604017239522692064",
// 	"344655487683634021937871920136313868094357065029119617", "483275292791706580980776443877591875353227274158988459", "573701029795899698630589255747609183174484352675215783", "-732580155014470242836134812994446574035164396495556271", "594330194650445385148944578283950521081680741771009899", "101203951825280408326305582643041317473282704339492709", "216278832918810044449722254905646662313674839394655619", "625134975240679470077245698337167066290607619898693009",
// 	"592159580197120593683986198804620539064892294932960480", "572431244424154359643281282046478499929323803155447895", "-585205772783822092698794217927064911638241460568226802", "-757013565173320648325704250993258686829832001390128195", "-353840682841748708149203424908212636592687662534807638", "595510683162110607056236597401377375515824954252954475", "-479789100671038479756025616307900282290908039704306912", "279441027164280914399115883367954133031628663687791712",
// 	"651843683845324655924756439797042727736701488993461593", "-483238204258213211277911105776718146049701324596604583", "-691307897610174434094025469621940287587760525208610112", "-452367607788878660497841019681970821420998164660305097", "-445598485439658837429884126899488440707481978004847213", "320219562546346482979076100098068095951618811589449701", "-752895362753738791847957182376095245492600859663324486", "474604555562852405745651829392872539137340376966567668",
// 	"-250246597295857486881145581976355189721990196976375261", "83293689464468402987040376604567975674504321238077664", "227221730556529029768522737087194999956752603005029095", "-314141899830036936513839641394447395447192865212662133", "17635643621117307490069231070063626039614522835794707", "723255923517556530848609945821575725307047505443235835", "262310584240721029376698440017818923728201329119000407", "180682346136299502048495827620714272454799995580839180",
// 	"221672551470243361679761716711298017371265570280977110", "185765307513005024555029316841435884031873096186670840", "-542659475953648527516612679703633669259390789740752128", "36555638028347619018263212513418868959170043247487330", "36225952557617527324801098235607861940476819434704872", "728136585487555773871990166084943748341658586188197922", "-456546095808422357241341963784763497450156881666791321", "321366579560842532505371293352965115995601849642409506",
// 	"93240360129234515452670573541210143978855986601981788", "693189200601630707266253110742386682194909242845483016", "-233064810723915013154429565363953369062580257580585298", "133318344320405936881188181268280549461565769763790340", "347719527243839312402760809002881682019998389816914988", "-507245927400085634061245100433269232337951571477721202", "590688055641825086063523762183987882976290181122035535", "576310224310798140840633771288477160653167945683950258",
// 	"277383509379179266612524349593060838981479010875664669", "-552842363080566684810608113001917762868028697891071535", "-87789326242195486414830476182975612954811851585830962", "-545634371224479409161860720412971213385143684292984598", "-549437182985312527196824812446902799521755143745509555", "-154565828253477306378067193101783751697758487998706999", "128074592197179807256441523493234290521125200186666891", "-229233293948216519844906922667598470972371901435277092",
// 	"652528331620766668482839029076825553643516417864040425", "2211075076533041597103402211753386027934578224279354", "748582157081955939908285420375936932130934385209187268", "-620296348538115502323789631209214827543420615887004720", "101737477645439745170824334541146446669329855097378295", "550254680266141582436069028614990175499408668531901960", "547825383095647543561208937973488821041626009207633756", "-164460375732106364320811270398571061184880346150674425",
// 	"326305341530055387837054937969384141689439984334534439", "399999644138846088363637579270975514718969564992518555", "-169026751161933431245978582737858742013807123491671200", "559767026097583233978361233722860894953867554313323454", "703136810450271848023143776454867899626453732437977655", "-313965560871670787671602960467237950716443148833622163", "-85843536850811797770632963955587048375134278717755282", "454170757840686720897214635738437209285462548642298861",
// 	"134684994469239486295701390986013012985928287399606387", "-379601052818558619406097364712023035245251372875341237", "-139257113176237641268575247448057576113585255019502293", "-532621897214575352931257731976667259733848062630986455", "-488903118478519809164742387205478030794258243854825094", "-175210274859937390621545921620959078117756290669243432", "450973876333816894706520136876122393340956486407749835", "599806209674919031427652109247361192563410869412458384",
// 	"486856327327190226170037369077265485644687799925648987", "45259495809353330778850188951845894235939508566173948", "628706261504856848792515349085788766887601323311640628", "-602656611003932603953383538405796842221199105890549817", "58239035333065205802900175405128920296835922186356873", "218964540395120165916922796948415431597985327726592037", "-178262482194241440647704556958898117479677322133278769", "34334378194149607855823771972524105483648014811142054",
// 	"378896501122611076562445555068719914420660972474797598", "352000461237102826338831423701857575095428718107197967", "-532890429316587060387437996936705901791379266693721464", "-598023770928278088105831671973597797133380607682466244", "-745024872338930251873934338816299316600333049351417342", "-202430491599812134245356624797760792164279511796413295", "713447841381209932750270510847967061521385346448849706", "718381384158850516405383117480328389873727740103865734",
// 	"179361264180796374685066798338629695980500610023888338", "-150942074456368664937277284441381024009253081150498745", "-664953248699771624780045139006253323355201532388976469", "-58773902488862659329267554964399953246401546838986122", "398001071387689533282893794804551335177781062508337690", "521990935231420405278075863398899922802606457388802311", "-224281342949850056299462406858503854613060293736320897", "-513053034680270018669203622244849852738046383124974438",
// 	"361344088419250682997897064639054014887375840880621250", "102890230447233849085599604460555580659349687373514510", "245889361569893357537275932587545923504939857767250750", "359137160150248743194396690706177061640459116852211957", "455614591324964581119035354640655600977993463941897452", "-583133020728536646560337993719308814855379669285626826", "-459546830038317450811184555210854299022007875398653283", "467136460385866961997422022359255513289265048136567602",
// 	"490463771227361004892260639991133135291988254794276666", "139506752315944225962858096437127982958641846655980352", "-748545043770131562294415624581384090232206826213206438", "-11249526587264071377975633641696685731350396484579133", "-534107429882009431709396072576972109875620461692900629", "124555264424549088110362918370693033497668014563557989", "174314435261201726150760056959683754906661472545563679", "-686729990418036136251583575698640799448664080241134340",
// 	"196463451365781208016442158936958796840357097270575793", "-587107139844171414176805727834316084240657095404110554", "277466106817713913594687115997891951167246456233190066", "427332214333408762815532226517303705372733396811987741", "-297464808724295106710572977659906190022269884402455961", "546823597606349062119094954385686127319699617966090196", "159011282501029833634846570465928690754290859357960361", "536796973965337656201711599077440012656945595302153158",
// 	"-96508056345300431883631537104877684384474189397638784", "407013382292222388340146494743431432716271718865947285", "750362661567694810227488335901409230438318397262299737", "-551592718549975844066494591935149683660704220702229458", "396590810395432588957669356763869134896653871697589187", "204016222906149773147129653304397475520962982371890785", "289626726036010261228568812871853026203210649462055425", "287480215356673693511015198708395097527481318754564648",
// 	"31309221947365006531203897479440534567591262592181441", "193064455160077644706021266939164247456811187099721242", "668971309495271068133225199327904169918345971969887346", "543417847917184845537690191641160909997084321134715673", "-479631265613430884399870010189347293838577822420271142", "304691751079418184690140756517655359862317392229215588", "471141446474111479136572688702982769213306630385440168", "-91763381151617643105902466146283604255122382950117542",
// 	"-353876695633569596206525429778213481564883348095340282", "-117954493106749811596145631309209457466512015421975949", "699354744939703414202468485285900543676186137883561201", "358929580731581471509135661104005599780275827131512431", "274932268601508009870750141058077647027677066155873771", "304244812704743392057457270951067020178150152945845167", "-652111380399953139282875754496136816490088292401329435", "-321256744264845832002902599999761800630430001468810290",
// 	"-283616699395762766490747684433506564071538119198054495", "-186914424609782867704250742176961482074563706254378268", "289319337656644982781345649825727239195353599351222124", "-318529433058329091080829862413268230643487347321431820", "481636316466209335944433695279927572477401542719285682", "-486443184771197297787607002771286165784716671324702683", "-137845630286886472930871268103110561642342944304642747", "540737111701687515607598726679720152350429588105470032",
// 	"638737252216236302330592435277081492752300452891793414", "-412316135307200309465463932600774200280804016174224085", "566517823161966845058836110730211142320798205101301792", "549523000156009303498615762984794741606010758114048538", "235167421710022655877434116245555582843437067654183916", "606099185845919385601830892371194115835646176630891195", "686631292795165743495643808268293774480385696676199122", "-183506175892087174960370223369582662855483391095556260",
// 	"-187439964193403855306572351213775031248649944618072865", "-455932159908045392442312756359797470852991360920447632", "-265561759449777564713913234913140035004794974178007891", "-723500040892946551651274551396767186227874412761729439", "-498478365863185054694421184623440289265646269588908574", "676298849944026365546222293030157633246053275126543025", "-365484938340835366591135362428686115602335830551038104", "-368308101559036521413646810691852925663115622918586958",
// 	"-601457487768911957995706967438767489817017538584427568", "-324930193624876693775361492372581560246828902466909848", "707594165391333085354547965726921800938088834591453125", "572642976385922274876380603971388604800763603624835477", "731257123543126521947841262536946800756701464806664970", "421542366322171989297859113816233686421133751041940360", "-54104422030719982619231486131301933135875235385198226", "-695044899412810930759898206920395022775687808020430945"
// };

// static const char *const zetas_str[N] = {
// 	"0", "-83520194008270792913531988438973471", "-83084535750020887373227307560943498", "-6560548809655498882325240297943926", "-79927306538961212783609604879251916", "66710194373081078263456272941549558", "-44179348717794929022858570156317695", "-51118363179937153122282049351563693",
// 	"-73487438013733623183323153918204262", "-57559284879483990201007655430065470", "-65694449765352139391442979420748490", "22655060732216821898953772212706207", "-6978360434513021338528386353777669", "69782122441713579511289126797673996", "39677012380941657632323708286675203", "-77236588009969489247325752200180146",
// 	"-27216222995349989858395331000690093", "13031166246370831395459718783396056", "34015972329176064007781173828981949", "-71306255375760894097180255234953605", "70967848180251616316841550049297717", "-39644676487405369506467630670728115", "-45041873887326497911851719955642405", "-61072771242983178366881216191581959",
// 	"38276598302402468374907193797070775", "-56416683036560775991259564023681730", "10656493242217886108008641701179860", "-69098415697082959091498493463021817", "17696567437933694215182178175131073", "40019226242552071915488870420346871", "-52258362874213384815160981100967469", "-18596281581666362035375320475721958",
// 	"-19377262786228278291147164389304119", "-2801873601176111181553639684617581", "-73520549554628977814420288072624670", "65682746253572049674235150630218184", "-66064239508112772360925845524317711", "80006497345650971354846183266394761", "-72673491092372252395706276653666475", "-18559476286168719596246015384154201",
// 	"29338468019879558032177123159491654", "-6820772838788946019395679706149451", "-56126911267904835569926229822127334", "26262486196187411142713926896345724", "-38738104424977660288422218731813228", "-28993667639221545841598374530066244", "-83560317412405760333375504479541706", "75619699697593883380733112536131789",
// 	"53060255833947586664535868880121540", "-48134728309783643332051576855171260", "59699580349944465447482663343954825", "75945713591192366377911730349424885", "66709134373435351119875399814587557", "-31477069149102445922575284246380095", "-80399662255166395532011161347258603", "-208867543586725066737708618674217",
// 	"12947126523801324277836997305979526", "-16340401663633433470266324879725912", "-55700416229464870356275424458887570", "50111474582763944532394759967156813", "73990707855971644305904080056830234", "-37170663694667102981551080530893322", "-60614062230449492688966766320804081", "-14052713915712720225020653216562837",
// 	"40232055873849934789491545552359075", "-62543736367216362157780226618538070", "-36313396470220852108498149088762863", "-56988085054703901073314667408605539", "14366150922641725629982333205001902", "51076165763065246621483084640403131", "10311121335728946001674341726643735", "70838518741514648431187866189813454",
// 	"77972189072504094051763204514032649", "-7067970738891357954385814356946523", "52948745900948069642206373891045429", "40260599241959794779591801703675112", "2120110614290643169346416673531600", "53938753169491198037097354578955076", "69176406899893540385836255438191643", "-75223855750753724855700300921598391",
// 	"33429443636638697582926604236211018", "68780101355927907356972722080011651", "-15734791114549547461707495930749640", "-71324656205832586191475627087319075", "82352611484252472085625397852287746", "-74863402229554668471181362611922296", "49229388827468327288470486249453103", "74111403735011960131292184724239293",
// 	"-53642376619349078254177916410974722", "-2280383280258867417845056038430983", "2844158254181638488975526350280922", "-17367371166168937834496543165423911", "74797171685316452362882882983749025", "-30207836243990724976700850551684150", "6167196704859497267700908034073921", "36197675307562250337015629252975255",
// 	"-21981407475071014372295585075054679", "8154606578937667683727247947506275", "47968119296108678849700428468008631", "-35749497530953761851617835661734654", "44528169718980497381292971389219823", "6036994230665169222955264955287279", "-54080314658476887258596346929659725", "72914926717367075814711386531972691",
// 	"-81143537786970783455709390646775164", "-39939490923320904956096135820184361", "77588851840675682178733261294702803", "58636240362816905762940979575743611", "77476633985171680096035933909483601", "30627448478690872762818913322622011", "48279077334346506499220749325251890", "-41341682186062987141113579131568817",
// 	"-33624099749301025290522529030255889", "-52810477003115877568113411469779058", "12152379690891003887661394145994442", "70978938809054823811745526887875176", "-58058867413000048272792269078831674", "10819719318681129735082588915829647", "62694654023112397201900060553168872", "33600512867410150672677200380091849",
// 	"-29135061093209433885704445969769499", "-42042985583576986151404510774736113", "-52820113159621925846457991592928915", "-49641938931075184092811992740611394", "35492533199691325314460308657959952", "-14291441270315540650597588496025293", "-35949352628818348816247974296058293", "79662665148969090716232702141960277",
// 	"1835946605529502887225069947270278", "51223604362876225724908121399688561", "-31817413768730094423054429370814297", "30319437545913248303260092965158867", "-44644789021165425206993823095422716", "-39903718367832394345899443318972378", "-47139670682730134996961687019851673", "-68216549482685992116175581111656074",
// 	"61762591668928073546063188893542079", "-66865589496325191257456002318013226", "4537584020846519121689177829696089", "60100002337582581445328600822371593", "-69787793112919579829609728829503038", "34019340872665500702206695266144787", "-64977806986385616128588429738805599", "-76302685731879444410764591984944330",
// 	"9840735481807420318267691365325138", "-55744067202644771642480424820484360", "16656504618469664280219979603473650", "-79398453370995465075031768132202400", "-59095876069252702146343796031699228", "-12881770662924072892075421356548196", "40665077990910050408839180032447709", "-73109825444039669871127171181291742",
// 	"14540524037863872161599466038809216", "75840552918835326114699476439696919", "-80673473285779470053826404904772740", "-25827340031450918681931837819651850", "-28913477590734519957134976695245671", "-57473567383136149478522476429489615", "-65486650913720970048807279001585634", "15738992650331689190493983372354901",
// 	"28078377496147070548682094437518103", "-55790326997234908908018156472080926", "-59899468559328107191213424878304847", "33427975293527890557375121955912290", "15247869242771836917443073667126164", "-52020597888844877792000595172916150", "-21419782454258107684390005859669214", "54324374986764109406533701467727300",
// 	"-59695616317987407187849634679781776", "-35012867258095291493467047847835917", "32499072780730023104175373820465553", "-45919057899896664556581036969271830", "-48604714277914049461856241259250578", "59507733746512747454589750922720496", "-11469897927867115914675034512652882", "-33074435826031035225766792927904311",
// 	"-16371945147899875841265281843170129", "54899696972177333966039507339204523", "74465521815084282853726918554296790", "-75562874256783310942986715477098330", "-50648355031553419612306129624204008", "-14549117646887305188562023399167348", "68064864400131661220084401802399927", "-37796782614922819625917005406784055",
// 	"71604808970201927855801370997075617", "56652687602128430376240469030302390", "70987671516643631153317864491377267", "-27444573638327882812232953451262845", "-18326424328989711430923763439106080", "-68468956895939102070655375165642362", "33661289856098068580848255221497844", "3151898953402760392047650088285939",
// 	"65364467254575442162683443051766483", "79362743365397519930834941363601528", "-13299640198394600745118533111843088", "-68354048835422242714458864256480751", "67389622516621149032516342607722099", "-2869789078579255772058310224434481", "-62469638085258529489308077999156875", "67498419645441840337980062411004262",
// 	"-27379025945547034414562422400353415", "67463672628976883108743790745117709", "23444342318404283348245736188599909", "-53336732407749192185487562431549276", "44176729837813758842296070450631547", "6207184162683377027384125878018909", "51224800019521321901245101025301116", "46599823829228012142031487837667651",
// 	"10905543321154450483437015124565467", "54766585009305688047697785102913443", "49041154280580157996925066791779987", "79908034316517017758237480225734093", "-33015610632411845996045172542026709", "79335438995970362837887639381887890", "-57071188112147191030105213003542227", "77951402290115118285349729640949772",
// 	"47358334881352947661824509823284688", "25044481971070224580328428951957081", "16265612784786023477425443639232744", "34345561153095109001804808716610126", "39176192171043739258707145079523365", "-63116426778356712577637480452289426", "78210507876759218015942040047081097", "73539298956776680277319397428879052",
// 	"42918555664095936933664288423909330", "41283586514275585527945637593220813", "81956033730916099068576171715488462", "34003875867476367022687618362436154", "-44237424797671492721812144014145700", "49858178477475780249932395231620839", "-58429148278555076165525363116930728", "-82876361737026199794087754372836758",
// 	"64788718351374330964240414189229206", "-26395750696487376028800687262215920", "60891040170916147548806627909814809", "35124595084110928344142706986105423", "5585479124601370681098526408659443", "-1609723502688297906473112817974748", "49294025740776948455835905999053904", "-71363022636451552125855022324003633",
// 	"-32883362997843725889576776455599369", "41845193556612836813682346429995499", "59617257826266744058833824038717927", "12955717736407611454812846977528347", "-23682480016135373931805817073847997", "69535276868419031424910925880299571", "42718227145758635821870788428267247", "16834884420967275982577807759598282",
// 	"6109978129111917956852672754201102", "-83413588678143261363593520974136166", "52901357462428504524815216496641030", "-58670337194036507233184955211516376", "-65769002680628632103126518624110698", "-77839120724313077819467222456834893", "2366506881057245275209055444689492", "-52835581724071384192350440454000356"
// };

// static const char *const zetas_str[N] = {
// 	"0", "-2689166864436868087751132007685247", "-9485030843328100731499716766591368", "-6132373987488788222666370488966501", "-1603069962423401929563426939020302", "10311694512207329509770088168361797", "-2165764256379761501156358805098937", "4410217124705575357782402659251163",
// 	"5291667004601167697662140081867150", "-1879337164829765404727338459510575", "-1011272931354486038376858549480764", "11537596618403835418397039248112388", "5645455571474121889661379191550440", "9609218567070841524502507420950987", "-6405692991221009759628103351658666", "9342237225474396094802130245138227",
// 	"4387079501839456744094438890403058", "8803493692344668124959661028375711", "3980821304011026868768336708429954", "-11407251416630824712782966154162367", "-1446056234202758029254172894845204", "-9416700828901467740987200198847017", "-8348487678855680160957855433871268", "7254730487347095976503252955439114",
// 	"9669959451943855615566110997309245", "10938147124635707129883717147092923", "-10284062264424208098394422284596452", "-3685890941810512250787877539517458", "6945984664719706784164148477040396", "5936980997903948286285132532818218", "6165032221431061136093769790632183", "-912764350089357962528144576605936",
// 	"9341272343751754004670954935019924", "11297902251666814017839976509050961", "-11717161980815973441415086516942878", "-5903116844270235700117013757998589", "-972170334273976084159465815550617", "-1535863131530890622007567046866718", "-22964906997558597380939615654984", "6640996222985723081403354316800390",
// 	"-2552314175787414488334189918096916", "5897364012580691590109952936146160", "11410279438302166950568261307129826", "-8261267940561018803704401972813857", "1173713877327599357752098404498011", "-1925915798090293426577352434860252", "1828431881929254764555275251825334", "-1874295105842780250090322466654644",
// 	"-5981348045682249829971626556365969", "-3232576374888209066460252685778899", "2749381968301031673676686419102201", "-2041220597825268629914862275847227", "-3879953885404210952088747547746781", "7573399293915881386201560506860910", "1922976084396189912170191280692523", "1478163080422964160989490827560835",
// 	"-499320317432182806138502378436110", "3311520632921895516235190522887533", "9229488118752594501799352924850966", "-10562830322098511574210622785952011", "11685680301326637764906813076088305", "648610795197966539218951693473926", "-2262633421494638959103046665487498", "6795515978584704090338003165733782",
// 	"3115874512686251954708024923303992", "-1175135283234509248287939344021375", "6073718546467975689720668508553293", "-6737262356203502526425604384736922", "-2442347283821853238253556584128123", "-2319918712269088210572880957111304", "-2980456675109711060384607364406588", "-3702097100506718894923732388703727",
// 	"1179040213527249541065740239281237", "9813191924536946969119368115226595", "-3177761499642619931715169688041762", "6067556868712223919437563547705982", "8922045906257407274588975046091216", "-10243049259648048512735416666602216", "3108153052192679092904890195008344", "-2463497839140296353020805050742502",
// 	"9756997999749039559520531681930771", "-5867663685876763669463718690798249", "-11642512795446848681363999499652592", "2462542094720653963701033750789480", "558785615075307316565987706006750", "-2278825411328821733252149722315278", "1738928905473005741405726124323143", "-6097707919633570765364755592828396",
// 	"2247663445061431723153645743006047", "8779844449779584005354199010117277", "4305508803484316409089971894124357", "6249112166508559122744756536283703", "-9325420821526039633736276301366573", "-11218419716529433189001117744856525", "-8936988735249847778606188752694879", "9163103941110375034116029301137735",
// 	"-9288858708785102561496708113596750", "11126733737896373565339943244572929", "10311009586498780138190982086222583", "-5417036961124836974430342506601217", "10746144782355007280527046453882785", "129204248957731231695888887546712", "-3549309666621356806330692353773649", "-11443863934227252774845300247230994",
// 	"4145175469494701663681147863445157", "-3760784487508014429178284545077983", "-8872792460779448908300477034950269", "2790708810898549782515717350239562", "-2717879803889472987824497106177144", "8062425241378367451710446223217884", "-10617401176451222392791744965886655", "8279037816561521444372030233364821",
// 	"-5223916147537775884523492245358267", "4114868551402024917078718385201863", "7226046675451322659141307219408127", "4931504439981131448680797329644866", "-7686610393493643530671237264350473", "-10203582839405294825820768095666227", "9993578977499528076045752786988840", "-10891644420903686507263026512352544",
// 	"-5440585078845031472837682669263767", "555541988275069086968174676650231", "-11255205079739780275448465340032713", "-5276804575012457360829895425265225", "-3240572406894261530994544665801743", "-825816906017758914399770466664647", "2351919194996227028444724825923838", "-1115051426869458184146410984314941",
// 	"4508385199857687734725074281858201", "8772587735337687175438385896044575", "-2957674054498128559806015840495603", "1588967224881726983904818153534", "-10251075217432018185580254574860281", "-704403717796158539210823724771007", "809788598077401927923008458949945", "-424688041156228159582680285217212",
// 	"-1582569978411773743110065707638885", "3731412271604207355719468333789340", "-10566894984080081294563950015882040", "8098303924362049326118307120734829", "-8207310227208772653398741125683542", "403319974724980093203124106586297", "8683458429868944492159936979493127", "-985884706962881910829278563403268",
// 	"-5227666764576131590121519252336399", "8181384408318293686255968550504985", "3974961390784856179503304762713142", "5279586450681190678824937064736999", "-6989557408601392281496906464756593", "-5823724924826406058831939875592627", "-1155323430139738822061493196832078", "4919424191701219592284757576075808",
// 	"-2160081444392053991310269722697850", "-5109696041895742736023739041972883", "188332530130028269436469188782945", "-10411662692433089424239854422535128", "-4487066452162611180567691930669518", "-11735857894152857694101363533902615", "-11611493229592221772803114582816877", "5641282071914533095031247767439239",
// 	"-9810210020662228394290701751626666", "-9092393502705998235656524605723749", "-10534210424936057615129220742793170", "10582740646342852753985423266322410", "-5787161672826028711008895376558294", "-4486387502227609587993746388368258", "2091664225612291239318688906600094", "-502905109993997522646072838209027",
// 	"11084541058198197933422123396727828", "-275853883910483927940167450236101", "-969558120166528567673875707183858", "-5525764684281742100088203654123726", "-5155250247193931048949651565818810", "7760782349595904934233883451752021", "3312126949949654980757874109994976", "8394004207111968180887197425835221",
// 	"2727733982239389601662405881560794", "3340098032442438693635345189352241", "3772840161028266239915389430112887", "8953668273509720698455702272922510", "9854851150689582402440476626905871", "-10744514039461480388829276311532574", "1771344764365229539790834506602366", "-1981527037489755098974855219020728",
// 	"-3530948131771606350526263672070282", "3336977125175288568149987704626168", "8607345961625419454421334175142065", "-5768028999667784517774579171491110", "4801538575116941422715248980362063", "4249146035607176760959147600489179", "589210901218305498901568478774007", "11111204862617581697502479249807373",
// 	"3116838407463194758604901429627742", "-4337182174253260476689147078813394", "-155056650968077735822382610524282", "-10678075102047513322695962329730032", "-7532008076911272924318325740617146", "6058873520755905310950264325349515", "-5225382369044203991807671346505671", "10368699304643961161876029280987591",
// 	"-5615965954028341908421071619919216", "-9097341523320713483472637062299374", "-8368512866889555159126425423066267", "9558198965046675339636051685391582", "6770021393737666788068303775256654", "2417892714400433719581131337936889", "6502099130273511583172280825937663", "-7610659732954219631886372553210681",
// 	"1434040603651391130877962235711019", "2659002835311141066136229421329901", "-3753629461330525564825352419612814", "9976059081700894572782703565396531", "-8414751803899197052025529737483734", "-5681472608053119051951880364834462", "-8904956951348164516964492939340626", "3076886120280604049454707902915388",
// 	"4717815405362815868781890825852892", "-7687648337281164492060062879974281", "5251724212967077826909138784419857", "-3332861328360839465966879307596442", "-8578834166323355184042340246731819", "-6661200139502739389784669001390300", "-10048449026626927890554857826376828", "10716599819049286983230657799713339",
// 	"11517608935994459966019320881919487", "-3482871534766581442780630403471922", "-1532429447367813776553447913600954", "1290360184462415709475149527780232", "-5861195062342931818337208069000666", "807080566394124280998768973526005", "5130058542935448663648098923604079", "-1979623200889520678891820898718133",
// 	"1376163699428288591074029261770455", "-10446820860469906011353560705590685", "-8889690679815790066018520516103922", "1473273818623153964381465912930412", "-1558147253013054609198265619588327", "2248190248196267164093125532085030", "-7548052752757115821022661177281665", "-3964709904205860076634503156889600",
// 	"799989977570000079535685059839540", "2724425880316812604097974718485474", "-2211715865022720436319218719475027", "-6822828270902104829977106060396531", "-9333299352016980820697406408790740", "-361822753652671011725884708668843", "-6121068963304717906762372084320932", "-11654071211139656625794063123253644",
// 	"1375721375578164427547417319066670", "2682101532297041619850527286439002", "-1885061107335100973738061998083822", "116113645697507887734949014404507", "-10301034092980609355274805489445034", "-11133046343786629698014572136656008", "-11612881713555025157098137222240481", "-11043683504561259389491972683753795"
// };
static const char *const zetas_str[N] = {
	"0", "-977410653565515420436803468605299", "-9279998386283219506050195815580812", "9377643366499077207731707401123499", "9264897715234434968679436690321681", "-6666465743465436042945626960832236", "-4382065757255126982055854737022017", "-10411528569265458286280332504476048",
	"-8508755598528190936519767854325227", "-11098309498938780170832027961847837", "11375398241845870557509931335787563", "-5418136120743596938381118106627714", "3364777213892262359183780141994703", "1755207841445696041018506990475313", "7142926212786378992622962300764892", "6279601160272647434236281743798603",
	"7115031432922298721471133955096242", "3829407188752892286849092149274655", "10406382698578747858271162414287056", "11089156656492051588555736850004740", "-1939261959844875000145813565292836", "6905119495580060381094889296883438", "-3223092359511468423969072217004308", "-6505816094061807143010832884704518",
	"7700349136647807413486516717080681", "6321389829261676659309643764974443", "9912900692132053305151232656603071", "-1540521358338254919854994843101389", "10059972904820708026385042629334017", "7003146605581710587377773696537213", "-6087857249655376371550227621387", "-8628683265453584235877027377432122",
	"-286200883138020120611043906607317", "8047825083807183538825415793383889", "10091637415146675816122144252715384", "862140902622164176566598114370688", "4897000146960325361651597533109723", "5270669894328081918895755126717888", "-9925393126393713678588901770109562", "-589357046801968439652856311692621",
	"10116292916186062840818288751835247", "-5785632260653392610002633277115018", "10369503961392658443705971073541030", "4359942497465229088602512330378142", "-7363192262716658363785235366719085", "-6774617063896326677051876089599427", "-387485024643068681868777770679619", "-9528009501231420470378669917340708",
	"-6975184173130166034356225248816194", "-10594355821637482223882332586606964", "4101209591686903959555039252857221", "-8720198392784600917098521361524649", "-309900173185671468774363675514316", "-4166672474601017807477423439252470", "5567967668554840427209074996144359", "-4461474456109060602186326881422806",
	"-9215710435856627767593681318398298", "10023404557671094041562720379174514", "9217743577394487563211618238105436", "-3312690013323143475649048841342580", "-8457119157697368030818023903051806", "-11387556926256216844525979635913801", "8664532535138451730332715423038879", "4705417862331513343719297736709277",
	"-2096596229604468137505832401628550", "3270175187809879191713654935483301", "-7246028110033073027111189252810676", "5320045459006506013342746342577084", "-7967265605167519754887906203125975", "-5635560571783759567685800050445682", "-4366718242070046795985283235258001", "-9382738306073871781310353368633501",
	"4838770911946000745842557470923439", "-4880324376359578085241090275441993", "6046451642723239482916801138069118", "-10695493470785540374969716990449723", "3280792947674750916829724743155152", "9131434958960248967537752355571240", "9282314023755659068711228472243637", "7982123074310642029866164948884435",
	"505470386867973012759487685041826", "-2103058627518356749000560300422009", "6261271759176764724244558595903360", "10024829660378746318455828474892185", "-10700436650188134707398032061488771", "-6039446658094555924602608105687094", "-449270108027761403461168522738587", "-9610625341977904165272371634734877",
	"-944469835692620629564004605927018", "7180512961447528457371641999044614", "4992555273295149753187184072602081", "-10009343638734185553307307231642551", "-3872597038734668002461176852330622", "9686486692390637480902421247953054", "-7141285030694783697199499738351813", "-7438102721439350970406582850478683",
	"3439873331830539100080587433414350", "2367867365857222946875747778300286", "836258249745525611431106494197551", "11254753650242542498422229074944019", "4789887114598508082436065327739201", "10594974975837714409936086009989306", "-4682723584439417317615886474365327", "-7064658549230876876235410794295317",
	"-5197709542724949726841411511346747", "-5246679404456099848525545940060194", "-75750967832809598281614529807430", "11158470430249069330729887200202475", "-2940658636058304523588229839948629", "7128675166375618538109347408859202", "9398786120437809534910434822008438", "11403529791319389575402499211230561",
	"2843862095372382751556626977739261", "-5212774800853344646578613637509641", "4903674921618317713333044296819700", "928203580524244888623521991382384", "-3962790924181223412818154955016746", "552734249184144704486390320699047", "-4630554763830558776389464344923161", "-8491484706598098463821930556967201",
	"-5136272477592774483955408199968346", "-7474705439031629866481936027385190", "1420572837282368853947080158688947", "11425957813101540040167389821691131", "7026308920470092178602949936934329", "-3732441065666954916867043534094452", "-4642933257210700742071738290841598", "-10522500618007196498072068884158673",
	"-3072873195648823291836995702674092", "-3356072105819456717581661173449339", "2313457297851048428315258472863695", "7790505538669377639527634286690053", "10936684941696057692516475414172972", "-3931119844099683554127949516635357", "-1498283232218550273880998073602053", "7614652706059933662724556320712387",
	"3312138594046196775240067946912615", "11199574169230327939978764058418596", "8059568864326480246177960655574792", "9633226998553641933988929581415874", "5968581895224291124611215102438562", "-6445710457407755082758871190255157", "2606190594299328502484170395423185", "2822640821850100131836621985681792",
	"-1564325096055728215320101611755262", "10929072650484270859335559196359450", "-10630107649764290037046040045106016", "1160264252371612438529993101499460", "-9231265905624908248150488528354476", "-8198437636512195210071883533490347", "-5015496995233026825896313228168663", "-7367116002868650223938215607201117",
	"-6170616911332065660007560834936990", "8651771022188383397459010086717670", "-4348838905948814220297432356222177", "-5177560901101973388667221677588512", "4561661694273247042325797016794704", "-7675857390045361806920672284828708", "8921413219210091082155841214308387", "-9929319742984295977055704605180013",
	"-9154698171458424987005008440410352", "-8633732415428016956060527814973340", "-4986834948077805419516353279794371", "-6275246270185161529751863712096107", "-2914556915417645783437535337016196", "6086593321447221900252469789747565", "-6253954037579132544240567856295911", "5346805099403581527546343775844389",
	"-5302215668824440240391766340590818", "-326341500527878550489592308227257", "9938519876178303600430842323229203", "8449337903244501035176704458938168", "2596211395458230798202511599729280", "312887638152184062106829669336224", "-7092688197164840468180624258816944", "-4020200321444471804909113966970237",
	"-8785699065588062066064805046975605", "-1235782161960884023030561492866596", "63079018943967535624369248292624", "10516585839092126088727188733350507", "3798109385553170303361062557536299", "-9536671722836487174786828707976949", "685763618891295928837968046037953", "-1339991447097200694112126122796839",
	"5120463330858279662551755912837929", "6991793728085545415982420435726553", "-7370451998358533117427873082307963", "1885306904653731747028028612231742", "-4150024659444915713644770429778869", "10620869638970289535086566925589277", "7217300432785361082044612457363535", "-9163225599945422939005673549964978",
	"9753219557884993464307828612806100", "10598861409443820154340832252784516", "-5802133250455691471189363490101703", "-4077769912839495426901236609001373", "10470215382920914171763764917458", "4591745007175015364289567403802871", "-2685070309720105619526398245141413", "-7171594677732988794776757282328052",
	"9081569234764171891868368265625934", "9786327326062669126506902807953526", "3389095245810554903204731220826518", "4592800071396789091071554671408520", "-3317691719720881159351361518736844", "4658619623957918984313347736466418", "-279325140224512304182684378055257", "-2816906866638597774612134266299692",
	"-797061980097197557320678930435553", "-9106987577485674934223185709316924", "9758949413620290804890563760987187", "-5789328345164048489175707339444597", "-921522010936478782398718681622666", "9232217760743487444994108814016847", "2591115309713415985591283755281556", "2326254898252141910516870842795056",
	"7835832496089671455715461053210958", "4130650515706994086633588928054132", "-4361457917730218756042810368419051", "5057503944811113637959789050118293", "11303391021060401397265479470229229", "2401009148248767977580790177859281", "10630291845664113258468131382372477", "4846307922336750254594580319926195",
	"5065452242839554082451318603759467", "5814150650383933040660177733952392", "11389646702382990008360879646761076", "5968863741142647378170417601422277", "6544044338175454186243329506193116", "6358437788389171002428951119982786", "-10103240268932786308229628868325080", "-5275812280467563203189738693281780",
	"-8986328501517548846173657114948758", "-5838867525270042732321221211776186", "10926801498540008871873353773809865", "-7003712210823482612662174694709704", "-6934548994360654691425896939564639", "-7714407643237191491757907643838793", "-8642456916271214146639592659065426", "1354700241067918719466844618516494",
	"5124996526184845218555842912413627", "2260438023483834005835154717109399", "11362882022220550745485745459165932", "-4045690547033842579752126646800804", "2857228102271928208085589096790041", "4759717180102153927633467857310269", "-6403744427649796003728116004278187", "4500751509535959614087837528233041",
	"-9653940598874091844599066407353357", "3532356397840293063669658887233273", "3134974155202124107533100749463553", "4907016216992814054132038143304665", "-1737797261317161910832216284182951", "10608020121814279556054430227879350", "-4125877615611480756795900609095122", "1318249896720194413048054110059023"
};



static mpz_t zetas[N];
void init_zetas(void)
{
    for (int i = 0; i < N; i++)
    {
        mpz_init(zetas[i]);
        mpz_set_str(zetas[i], zetas_str[i], 10);
    }
}

void clear_zetas(void)
{
    for (int i = 0; i < N; i++)
    {
        mpz_clear(zetas[i]);
    }
}
// Optional helper: fuse multiply + Montgomery reduction
static inline void montgomery_mul(mpz_t r, mpz_srcptr x, mpz_srcptr y) {
    mpz_mul(r, x, y);
    montgomery_reduce(r, r);   // r := MontRed(r)
}

/*************************************************
 * Name:        ntt
 * Description: Forward NTT, in-place. No modular reduction after +/- (lazy).
 *              Output is in bit-reversed order.
 **************************************************/
void ntt(mpz_t a[N])
{
    unsigned int len, start, j, k = 0;

    // Pre-size temporaries to avoid realloc in the loop (t, prod, tmp).
    // Choose bit sizes appropriate for your modulus q and products.
    mpz_t t, prod, tmp;
    // If you know q ~ b bits, use ~b for tmp/t and ~(2b+logN) for prod.
    mpz_init2(t,   256);   // adjust to >= bits(q) + headroom
    mpz_init2(prod,512);   // adjust to >= 2*bits(q) + headroom
    mpz_init2(tmp, 256);

    for (len = N >> 1; len > 0; len >>= 1) {
        for (start = 0; start < N; start += (len << 1)) {
            mpz_srcptr zeta = zetas[++k];            // take pointer; no copy
            for (j = start; j < start + len; ++j) {
                // t = zeta * a[j+len] (Montgomery)
                // Option A (fused):
                montgomery_mul(t, zeta, a[j + len]);
                // Option B (if you prefer to keep prod):
                // mpz_mul(prod, zeta, a[j + len]);
                // montgomery_reduce(t, prod);

                // Butterfly:
                // tmp = a[j] + t
                mpz_add(tmp, a[j], t);
                // a[j+len] = a[j] - t
                mpz_sub(a[j + len], a[j], t);
                // a[j] = tmp
                mpz_set(a[j], tmp);
            }
        }
    }

    mpz_clears(t, prod, tmp, NULL);
}

/*************************************************
 * Name:        ntt
 *
 * Description: Forward NTT, in-place. No modular reduction is performed after
 *              additions or subtractions. Output vector is in bitreversed order.
 *
 * Arguments:   - mpz_t p[N]: input/output coefficient array
 **************************************************/
// void ntt(mpz_t a[N])
// {
//     unsigned int len, start, j, k;
//     mpz_t t, zeta, prod;
//     mpz_inits(t, zeta, prod, NULL);

//     k = 0;
//     for (len = N / 2; len > 0; len >>= 1)
//     {
//         for (start = 0; start < N; start = j + len)
//         {
//             k++;
//             mpz_set(zeta, zetas[k]);
//             for (j = start; j < start + len; ++j)
//             {
//                 mpz_mul(prod, zeta, a[j + len]);
//                 montgomery_reduce(t, prod);

//                 mpz_t tmp;
//                 mpz_init(tmp);
//                 mpz_set(tmp, a[j]);

//                 // a[j] = tmp + t
//                 mpz_add(a[j], tmp, t);
//                 // a[j+len] = tmp - t
//                 mpz_sub(a[j + len], tmp, t);

//                 mpz_clear(tmp);
//             }
//         }
//     }
//     mpz_clears(t, zeta, prod, NULL);
// }

/*************************************************
 * Name:        invntt_tomont
 *
 * Description: Inverse NTT and multiplication by Montgomery factor 2^32.
 *              In-place. No modular reductions after additions or
 *              subtractions; input coefficients need to be smaller than
 *              Q in absolute value. Output coefficient are smaller than Q in
 *              absolute value.
 *
 * Arguments:   - uint32_t p[N]: input/output coefficient array
 **************************************************/
void invntt_tomont(mpz_t a[N])
{
    unsigned int start, len, j, k;
    mpz_t f, prod, zeta;
    mpz_inits(f, prod, zeta, NULL);

    mpz_set(f, GMP_DIV);

    k = N;
    for (len = 1; len < N; len <<= 1)
    {
        for (start = 0; start < N; start = j + len)
        {
            k--;
            // Can this be done in one step maybe? Just mpz_neg(zeta, zetas[k])?
            mpz_set(zeta, zetas[k]);
            mpz_neg(zeta, zeta);
            for (j = start; j < start + len; ++j)
            {
                mpz_t tmp;
                mpz_init(tmp);
                mpz_set(tmp, a[j]);

                // a[j] = tmp + a[j + len]
                mpz_add(a[j], tmp, a[j + len]);
                // a[j+len] = tmp - a[j + len]
                mpz_sub(a[j + len], tmp, a[j + len]);

                mpz_clear(tmp);

                // a[j+len] = zeta * a[j+len] % Q
                mpz_mul(prod, zeta, a[j + len]);
                montgomery_reduce(a[j + len], prod);
            }
        }
    }

    for (j = 0; j < N; ++j)
    {
        mpz_mul(prod, f, a[j]);
        montgomery_reduce(a[j], prod);
    }
}